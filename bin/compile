#!/usr/bin/env bash

function indent() {
    c='s/^/       /'
    case $(uname) in
        Darwin) sed -l "$c";;
        *)      sed -u "$c";;
    esac  
}

function topic() {
  echo "-----> $*"
}

topic "Downloading Platfrom.sh cli"
curl -sS https://platform.sh/cli/installer | php | indent

topic "Creating source file"
mkdir -p $HOME/.profile.d
new_source_file=$HOME/.profile.d/platformsh.sh
touch $new_source_file
chmod +x $new_source_file
echo 'export PATH="$HOME/"'\''.platformsh/bin'\'':"$PATH"' > $new_source_file

topic "Adding keys to known_hosts"
mkdir -p $HOME/.ssh
test -f $HOME/.ssh/known_hosts|| touch  $HOME/.ssh/known_hosts
ssh-keyscan 'ssh.eu-2.platform.sh' >> $HOME/.ssh/known_hosts | indent
ssh-keyscan 'git.eu-2.platform.sh' >> $HOME/.ssh/known_hosts | indent
